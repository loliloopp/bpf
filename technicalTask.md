ТЕХНИЧЕСКОЕ ЗАДАНИЕ (v 1.1)
Проект: Blueprintflow — портал отдела анализа рабочей документации и сметного отдела
Дата: 31 июля 2025 г.
Назначение: ТЗ для разработки и последующей загрузки в Codex/Confluence.

ЦЕЛИ И ОТЛИЧИЯ НОВОЙ ВЕРСИИ
• Поддержка OAuth 2 (Google, Microsoft) поверх Supabase Auth.
• Добавлена роль «Администратор».
• Импорт Ведомостей объемов работ (ВОР), шахматок и смет из Excel.
• Библиотека работ/материалов для повторного использования.
• Дашборд аналитики (win‑rate, динамика затрат).
• Onboarding‑wizard и AI‑подсказки от Codex.
• WCAG 2.1 AA, mobile‑first.
• Optimistic‑locking и resolver конфликтов при совместном редактировании.

ОБЗОР РЫНКА И ПРИНЯТЫЕ BEST‑PRACTICE
Cost estimating & take‑off: CostOS, STACK, RIB Candy – совместное редактирование и библиотеки позиций.
Document management: Oracle Aconex, Bluebeam – массовая загрузка чертежей, встроенный PDF/DWG‑viewer.
Bid management: Procore, Autodesk ACC – хронология и дашборды win‑rate.
Procurement workflow: ProcurePro – сквозной процесс «тендер → договор → шахматка → ВОР или смета → закупка и поставка материалов на стройку» с анализом объемов материалов и работ, стоимости, рентабельности, затрат и рисков.

ФУНКЦИОНАЛЬНЫЕ ТРЕБОВАНИЯ

3.1 Импорт ВОР, смет и шахматок
F‑1.1  Excel/CSV (xlsx, xls, csv).
F‑1.2  Хранение исходных файлов в Supabase Storage
F‑1.3  Импорт и анализ чертежей PDF/DWG, подсчет данных по чертежам.

3.2 Пользователи и роли
Администратор — управление пользователями, справочниками, настройками расчетных коэфициентов, импорт документов, назначение пользователей, привелегий, распределение привелегий по ролям, утверждение цен на материалы и работы.
Инженер — редактирование строк, загрузка документов, загрузка чертежей, анализ DWG с помощью нейросетей, редактирование отдельных справочников.
Просмотр — только чтение.
Аутентификация: Supabase Auth (e‑mail + пароль) + OAuth.


3.3 Файлы
• Drag‑and‑drop, до 250 МБ.
• Предпросмотр PDF, изображений, таблиц XLS, документов DOC/TXT/RTF/ODT.
• Версионирование по подпапкам с датой.

3.4 Синхронность и конфликты
• Supabase Realtime, канал Blueprintflow:{id}.
• Optimistic locking по updated_at.
• Resolver при конфликте: «Объединить / Перезаписать / Откатить».
• Цель latency < 300 мс.

3.5 Библиотека позиций
• Таблицы works и nomenclature.
• Импорт из Excel и прошлых тендеров и расчетов.
• Поиск по классификатору (при необходимости ГЭСН/ТСН).

3.6 Аналитика и отчёты
• Дашборд: количество шахматок, ВОР, прямые и коммерческие затраты, сумма расчетов дополнительных соглашений (ДС) в работе/готовых, количество шифров рабочей документации (РД) в очереди/работе/готовых.
• Отчёты XLSX/PDF: ВОР на основе шахматки, смета на основе шахматки, сумма ДС по проектам.
• Графики договорной стоимости, стоимости с учетом ДС, суммы затрат.


АРХИТЕКТУРА РЕШЕНИЯ

Front‑end: React 18, TypeScript, Vite, Ant Design 5, TanStack Query.
Real‑time: Supabase Realtime WebSocket.
Back‑end: Supabase (PostgreSQL 16, Edge Functions Deno, Storage).
DevOps: GitHub Actions → Vercel (FE) / Supabase Cloud (BE).
Observability: Sentry, Grafana Cloud, OTEL.

UX‑РЕШЕНИЯ
Onboarding‑wizard (пошаговая загрузка ВОР/смет/шахматок, настройка марк‑апов).
AI‑assist Codex (предложения материалов по ключевым словам).
Drag‑to‑select для групповых действий.

Горячие клавиши: Alt+Enter (новая подстрока), Ctrl+S (сохранить).

НЕФУНКЦИОНАЛЬНЫЕ ТРЕБОВАНИЯ
Производительность: импорт 5 000 строк Excel ≤ 30 с; рендер 10 000 строк ≤ 100 мс.
Параллелизм: 100 одновременных пользователей (k6 — 100 VU × 2 мин без ошибок).
Доступность: 99,9 % в месяц; mobile‑friendly; WCAG 2.1 AA.
Безопасность: TLS 1.3, RLS, MFA; ноль критических OWASP‑рисков.
Масштабируемость: горизонтальный upscale кластера Realtime.
Управляемость: history_log, Sentry alerts, MTTR ≤ 5 мин.


КРИТЕРИИ ПРИЁМКИ

Импорт 5 000 строк ≤ 30 с.
Совместное редактирование (2 инженера) без конфликтов, latency < 300 мс.
Корректный пересчёт цены при смене расценок на работы и стоимости материалов, коэффициента расхода.
Полная запись действий в history_log.
OWASP ZAP — 0 критических уязвимостей.
API /Blueprintflow/{id}/rows (95‑й перцентиль) < 150 мс.
Дашборд win‑rate обновляется минимум раз в сутки.

