# Дизайн и структура портала Blueprintflow

## Общие принципы
- **Фреймворк**: React 18 + TypeScript + Vite.
- **UI-библиотека**: Ant Design 5 (mobile‑first, WCAG 2.1 AA).
- **Состояние и данные**: TanStack Query для работы с Supabase API.
- **Аутентификация**: Supabase Auth (OAuth2 Google и Microsoft).
- **Обзор и файловый просмотр**: PDF, XLS, DOC, DWG через встроенные превью.
- **Табличный формат**: Все документы и справочники отображаются в виде таблиц с сортировкой, фильтрацией и постраничной навигацией.

## Макет страниц
### 1. Боковое меню (Sider)
Реализовано через `Layout` из Ant Design. Слева фиксированное вертикальное меню шириной 240 px.

```
Dashboard
Документы
  ├── Шахматка
  ├── Шахматка монолит
  ├── ВОР для подрядчиков
  └── Смета
Библиотека
  ├── Документация
  ├── Шифры РД
  └── Шифры ПД
Справочники
Отчёты
Администрирование
```

Иконки из Ant Design Icons. Разделы с подпунктами раскрываются аккордеоном.

### 2. Dashboard
- **Зона уведомлений**: верхний блок на всю ширину, 3–5 строк.
- **Виджеты**: сетка из карточек (Ant Design `Card` + `Grid`), например:
  - Количество шахматок, ВОР, смет.
  - Динамика затрат.
  - Win‑rate и ключевые показатели.

### 3. Документы
Каждый документ открыт в отдельной вкладке (`Tabs`). Таблицы загружаются из Supabase.

| Документ | Таблица | Особенности |
|----------|---------|-------------|
| Шахматка | `estimate` | Импорт/экспорт XLSX, превью файлов. |
| Шахматка монолит | `estimate_monolith` | Аналогично, выделен тип "монолит". |
| ВОР для подрядчиков | `estimate` | Фильтры по подрядчикам и статусу. |
| Смета | `estimate` или `estimate_monolith` в зависимости от категории затрат. |

Табличный интерфейс включает: inline‑редактирование, пагинацию, drag‑and‑drop загрузку, версионирование по подпапкам с датой.

### 4. Библиотека
Три вкладки, каждая таблица с фильтрами и поиском:
- **Документация** → таблица `blueprints`.
- **Шифры РД** → таблица `blueprints_RD`.
- **Шифры ПД** → таблица `blueprints_PD`.

### 5. Справочники
Дерево справочников, связанные с другими таблицами БД (кроме маппинг‑таблиц). Общий компонент `ReferenceTable` для просмотра и редактирования.

### 6. Отчёты
Раздел с конструктором отчётов и готовыми выгрузками (PDF/XLSX). Запуск генерации в Supabase Edge Functions.

### 7. Администрирование
Управление пользователями, ролями (Администратор, Инженер, Просмотр), журнал действий `history_log`.

## Подключение к Supabase
```ts
import { createClient } from '@supabase/supabase-js'

const supabase = createClient(import.meta.env.VITE_SUPABASE_URL, import.meta.env.VITE_SUPABASE_ANON_KEY, {
  auth: { persistSession: true }
})
```
- Realtime: канал `Blueprintflow:{id}` для совместного редактирования с optimistic locking по `updated_at`.

## Адаптивность
- Минимум 320 px ширина, mobile‑first.
- Верхняя панель сворачивает меню в иконки на узких экранах.

## Accessibility и безопасность
- Контрастные цвета, клавиатурная навигация.
- TLS 1.3, RLS в БД, MFA.
- OWASP ZAP → 0 критических уязвимостей.

## Диаграмма навигации
```
Dashboard
└─ Виджеты
Документы
├─ Шахматка
├─ Шахматка монолит
├─ ВОР для подрядчиков
└─ Смета
Библиотека
├─ Документация
├─ Шифры РД
└─ Шифры ПД
Справочники
└─ Выбор таблиц
Отчёты
└─ Генерация и история
Администрирование
├─ Пользователи
└─ Роли и журнал
```

Документ создаёт основу для дальнейшей реализации интерфейса и интеграции с Supabase.
