<!DOCTYPE html>
<html>
<head>
    <title>Test Database Connection</title>
    <script type="module">
        // –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º Supabase
        import { createClient } from 'https://cdn.skypack.dev/@supabase/supabase-js'

        const supabaseUrl = 'https://hfqgcaxmufzitdfafdlp.supabase.co'
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhmcWdjYXhtdWZ6aXRkZmFmZGxwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ4OTI5MjMsImV4cCI6MjA3MDQ2ODkyM30.XnOEKdwZdJM-DilhrjZ7PdzHU2rx3L72oQ1rJYo5pXc'

        const supabase = createClient(supabaseUrl, supabaseKey)

        async function testConnection() {
            try {
                console.log('üîç Testing connection to nomenclature table...')

                // –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π
                const { count, error: countError } = await supabase
                    .from('nomenclature')
                    .select('*', { count: 'exact', head: true })

                console.log('üîç Total records count:', count, 'error:', countError?.message || 'none')

                // –¢–µ—Å—Ç 2: –ü–æ–ª—É—á–∞–µ–º –ø–µ—Ä–≤—ã–µ 3 –∑–∞–ø–∏—Å–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
                const { data: sampleData, error: sampleError } = await supabase
                    .from('nomenclature')
                    .select('*')
                    .limit(3)

                console.log('üîç Sample data:', sampleData)
                console.log('üîç Sample error:', sampleError?.message || 'none')

                if (sampleData && sampleData.length > 0) {
                    console.log('üîç Available columns:', Object.keys(sampleData[0]))
                    console.log('üîç Sample record structure:', sampleData[0])
                }

                // –¢–µ—Å—Ç 3: –ü—Ä–æ–±—É–µ–º –ø–æ–∏—Å–∫ "–ø–µ–Ω–æ–ø–æ–ª–∏—Å—Ç–∏—Ä–æ–ª"
                const { data: searchResults, error: searchError } = await supabase
                    .from('nomenclature')
                    .select('*')
                    .ilike('name', '%–ø–µ–Ω–æ–ø–æ–ª–∏—Å—Ç–∏—Ä–æ–ª%')
                    .limit(10)

                console.log('üîç Search results for "–ø–µ–Ω–æ–ø–æ–ª–∏—Å—Ç–∏—Ä–æ–ª":', searchResults?.length || 0, 'matches')
                console.log('üîç Search error:', searchError?.message || 'none')
                console.log('üîç Search data:', searchResults?.slice(0, 3))

                // –¢–µ—Å—Ç 4: –ü—Ä–æ–±—É–µ–º –ø–æ–∏—Å–∫ –ø–æ –¥—Ä—É–≥–∏–º –ø–æ–ª—è–º
                if (sampleData && sampleData.length > 0) {
                    const firstRecord = sampleData[0]
                    const possibleNameFields = ['name', 'nomenclature_name', 'title', 'description', 'material_name']

                    for (const field of possibleNameFields) {
                        if (firstRecord.hasOwnProperty(field)) {
                            console.log(`üîç Testing search by field "${field}"...`)
                            const { data: fieldResults, error: fieldError } = await supabase
                                .from('nomenclature')
                                .select('*')
                                .ilike(field, '%–ø–µ–Ω–æ–ø–æ–ª–∏—Å—Ç–∏—Ä–æ–ª%')
                                .limit(5)

                            console.log(`üîç Field "${field}" results:`, fieldResults?.length || 0, 'matches')
                            if (fieldResults && fieldResults.length > 0) {
                                console.log(`üîç Sample from "${field}":`, fieldResults.slice(0, 2))
                            }
                        }
                    }
                }

                document.getElementById('results').innerHTML = `
                    <h3>Database Connection Test Results:</h3>
                    <p>Total records: ${count || 'unknown'}</p>
                    <p>Sample data retrieved: ${sampleData?.length || 0} records</p>
                    <p>Search results for "–ø–µ–Ω–æ–ø–æ–ª–∏—Å—Ç–∏—Ä–æ–ª": ${searchResults?.length || 0} matches</p>
                    <p>Check console for detailed logs</p>
                `

            } catch (error) {
                console.error('üîç Connection test failed:', error)
                document.getElementById('results').innerHTML = `
                    <h3>Connection Test Failed:</h3>
                    <p>Error: ${error.message}</p>
                `
            }
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', testConnection)
    </script>
</head>
<body>
    <h1>Database Connection Test</h1>
    <div id="results">Testing connection...</div>
</body>
</html>