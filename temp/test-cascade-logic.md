# Тест каскадной зависимости номенклатуры и поставщиков

## Реализованная функциональность

### 1. API функции (`chessboard-cascade-api.ts`)
- ✅ `getSuppliersByNomenclature(nomenclatureId)` - получение поставщиков по номенклатуре
- ✅ `getNomenclatureBySupplier(supplierId)` - получение номенклатуры по поставщику
- ✅ `getAllNomenclature()` - получение всех номенклатур
- ✅ `getAllSuppliers()` - получение всех поставщиков
- ✅ `isNomenclatureSupplierLinked()` - проверка связи номенклатуры и поставщика

### 2. Каскадный хук (`useNomenclatureSupplierCascade.ts`)
- ✅ Автоматическая загрузка справочников
- ✅ Каскадная фильтрация поставщиков при выборе номенклатуры
- ✅ Автоподстановка номенклатуры при выборе поставщика
- ✅ Валидация связей
- ✅ Обработчики изменений с коллбэками

### 3. Интеграция в ChessboardTable
- ✅ Замена прямых useQuery на каскадный хук
- ✅ Обновленная логика в колонке "Номенклатура"
- ✅ Обновленная логика в колонке "Наименование поставщика"
- ✅ Динамическое изменение placeholder'ов и опций

## Логика работы

### При выборе номенклатуры:
1. Пользователь выбирает номенклатуру
2. Каскадный хук фильтрует поставщиков только для этой номенклатуры
3. Поле поставщика очищается и показывает только связанных поставщиков
4. Placeholder меняется на "Поставщики для номенклатуры"

### При выборе поставщика первым:
1. Пользователь выбирает поставщика (номенклатура пустая)
2. Каскадный хук автоматически находит связанную номенклатуру
3. Номенклатура автоматически подставляется
4. Поставщик фильтруется под выбранную номенклатуру

## Тестовые сценарии

### Сценарий 1: Номенклатура → Поставщик
1. Открыть таблицу Шахматка
2. Перейти в режим редактирования строки
3. Выбрать номенклатуру из списка
4. Проверить, что в поле поставщика показываются только связанные поставщики
5. Выбрать поставщика из отфильтрованного списка

### Сценарий 2: Поставщик → Номенклатура
1. Открыть таблицу Шахматка
2. Перейти в режим редактирования строки
3. Выбрать поставщика (номенклатура пустая)
4. Проверить, что номенклатура автоматически подставилась
5. Проверить, что поставщик остался выбранным

### Сценарий 3: Изменение номенклатуры
1. Выбрать номенклатуру A и поставщика из её списка
2. Изменить номенклатуру на B
3. Проверить, что поставщик сбросился
4. Проверить, что список поставщиков обновился для номенклатуры B

## Структура БД

```sql
-- Основные справочники
nomenclature (id, name)
supplier_names (id, name)

-- Связующая таблица "многие ко многим"
nomenclature_supplier_mapping (nomenclature_id, supplier_id)

-- Связь с таблицей шахматки
chessboard_nomenclature_mapping (
  chessboard_id,
  nomenclature_id,
  supplier_name -- текстовое поле поставщика
)
```

## Статус тестирования

- [ ] Проверить загрузку справочников
- [ ] Тест каскадной фильтрации (номенклатура → поставщик)
- [ ] Тест автоподстановки (поставщик → номенклатура)
- [ ] Тест очистки зависимых полей
- [ ] Тест валидации связей
- [ ] Проверить сохранение в БД