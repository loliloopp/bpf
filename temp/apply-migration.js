import { readFileSync } from 'fs'
import { fileURLToPath } from 'url'
import { dirname, join } from 'path'

const __filename = fileURLToPath(import.meta.url)
const __dirname = dirname(__filename)

// –ß–∏—Ç–∞–µ–º SQL —Ñ–∞–π–ª
const sqlPath = join(__dirname, '..', 'sql', 'fix_import_nomenclature_single_batch.sql')
const sql = readFileSync(sqlPath, 'utf-8')

console.log('\nüì¶ –ò–ù–°–¢–†–£–ö–¶–ò–Ø –ü–û –ü–†–ò–ú–ï–ù–ï–ù–ò–Æ SQL –ú–ò–ì–†–ê–¶–ò–ò')
console.log('=' .repeat(80))
console.log('\n‚ö†Ô∏è  Supabase JS Client –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ DDL –∫–æ–º–∞–Ω–¥ —á–µ—Ä–µ–∑ API.')
console.log('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é –≤—Ä—É—á–Ω—É—é –æ–¥–Ω–∏–º –∏–∑ —Å–ø–æ—Å–æ–±–æ–≤:\n')

console.log('‚úÖ –í–ê–†–ò–ê–ù–¢ 1: Supabase Dashboard (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)')
console.log('1. –û—Ç–∫—Ä–æ–π—Ç–µ: https://app.supabase.com')
console.log('2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç')
console.log('3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ: SQL Editor')
console.log('4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞: sql/fix_import_nomenclature_single_batch.sql')
console.log('5. –ù–∞–∂–º–∏—Ç–µ RUN')

console.log('\n‚úÖ –í–ê–†–ò–ê–ù–¢ 2: psql (–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)')
console.log('psql "$DATABASE_URL" -f sql/fix_import_nomenclature_single_batch.sql')

console.log('\n‚úÖ –í–ê–†–ò–ê–ù–¢ 3: Supabase CLI')
console.log('npx supabase db execute --file sql/fix_import_nomenclature_single_batch.sql')

console.log('\n' + '=' .repeat(80))
console.log('üìÑ –ß–¢–û –î–ï–õ–ê–ï–¢ –≠–¢–ê –ú–ò–ì–†–ê–¶–ò–Ø:')
console.log('=' .repeat(80))
console.log('üéØ –ö–õ–Æ–ß–ï–í–û–ï –ò–ó–ú–ï–ù–ï–ù–ò–ï: –§—É–Ω–∫—Ü–∏—è —É–¥–∞–ª—è–µ—Ç –û–î–ò–ù –±–∞—Ç—á –∑–∞ –≤—ã–∑–æ–≤, –ù–ï —Ü–∏–∫–ª')
console.log('')
console.log('üö® –ü–†–û–ë–õ–ï–ú–ê 1: –û–î–ò–ù DELETE > 15 –º–∏–Ω—É—Ç (–º–∏–ª–ª–∏–æ–Ω—ã –∑–∞–ø–∏—Å–µ–π)')
console.log('üö® –ü–†–û–ë–õ–ï–ú–ê 2: LOOP –≤–Ω—É—Ç—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–∏ = –≤–µ—Å—å —Ü–∏–∫–ª –≤ –æ–¥–Ω–æ–º –≤—ã–∑–æ–≤–µ = timeout')
console.log('‚úÖ –†–ï–®–ï–ù–ò–ï: –§—É–Ω–∫—Ü–∏—è —É–¥–∞–ª—è–µ—Ç –¢–û–õ–¨–ö–û –û–î–ò–ù –±–∞—Ç—á, —Ü–∏–∫–ª –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ')
console.log('')
console.log('‚úÖ –°–æ–∑–¥–∞—ë—Ç –î–í–ï —Ñ—É–Ω–∫—Ü–∏–∏:')
console.log('   1. prepare_import_nomenclature(suppliers_list) - —É–¥–∞–ª—è–µ—Ç –û–î–ò–ù –±–∞—Ç—á (–¥–æ 50k)')
console.log('   2. import_nomenclature(batch) - –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –±–∞—Ç—á–∏ –ë–ï–ó DELETE')
console.log('')
console.log('‚úÖ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:')
console.log('   1. –§—Ä–æ–Ω—Ç–µ–Ω–¥ –≤—ã–∑—ã–≤–∞–µ—Ç prepare_import_nomenclature() –í –¶–ò–ö–õ–ï')
console.log('   2. –ö–∞–∂–¥—ã–π –≤—ã–∑–æ–≤ = –û–î–ò–ù –±–∞—Ç—á (–¥–æ 50,000 –∑–∞–ø–∏—Å–µ–π –∑–∞ ~30-60 —Å–µ–∫)')
console.log('   3. –§—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–¥–∞–ª—ë–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π')
console.log('   4. –¶–∏–∫–ª –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è, –ø–æ–∫–∞ —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ –≤–µ—Ä–Ω–µ—Ç 0')
console.log('   5. –§—Ä–æ–Ω—Ç–µ–Ω–¥ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å: "–£–¥–∞–ª–µ–Ω–æ 150,000 —Ü–µ–Ω (–∏—Ç–µ—Ä–∞—Ü–∏—è 3)..."')
console.log('   6. –ü–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –±–∞—Ç—á–∏ –ø–æ 100 —Å—Ç—Ä–æ–∫ –ë–ï–ó DELETE')
console.log('')
console.log('‚úÖ –î–ª—è –ù–û–í–´–• –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤: —Å–æ–∑–¥–∞—ë—Ç UUID + –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ')
console.log('‚úÖ –î–ª—è –°–£–©–ï–°–¢–í–£–Æ–©–ò–• –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤: —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç UUID + –ü–ï–†–ï–ó–ê–ü–ò–°–´–í–ê–ï–¢:')
console.log('   - unit_id, material_group –≤ supplier_names')
console.log('   - –í–°–ï –¶–ï–ù–´ –≤ material_prices')
console.log('')
console.log('‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:')
console.log('   - –§—É–Ω–∫—Ü–∏—è —É–¥–∞–ª—è–µ—Ç –û–î–ò–ù –±–∞—Ç—á (50k –∑–∞–ø–∏—Å–µ–π), –ù–ï —Ü–∏–∫–ª')
console.log('   - –¶–∏–∫–ª –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ - –∫–∞–∂–¥—ã–π –≤—ã–∑–æ–≤ < 2 –º–∏–Ω—É—Ç')
console.log('   - –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏–∏ JOIN')
console.log('   - –ò–Ω–¥–µ–∫—Å—ã –Ω–∞ –≤—Å–µ—Ö –∫–ª—é—á–µ–≤—ã—Ö –ø–æ–ª—è—Ö')
console.log('   - statement_timeout: 2 –º–∏–Ω—É—Ç—ã –¥–ª—è prepare, 3 –º–∏–Ω—É—Ç—ã –¥–ª—è import')
console.log('   - –†–∞–∑–º–µ—Ä –±–∞—Ç—á–∞ –∏–º–ø–æ—Ä—Ç–∞ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ: 100 —Å—Ç—Ä–æ–∫')

console.log('\n' + '=' .repeat(80))
console.log('üìÑ –°–û–î–ï–†–ñ–ò–ú–û–ï SQL –ú–ò–ì–†–ê–¶–ò–ò:')
console.log('=' .repeat(80))
console.log(sql)
console.log('=' .repeat(80))

console.log('\nüí° –ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∏–º–ø–æ—Ä—Ç —á–µ—Ä–µ–∑ UI:')
console.log('   1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ù–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞')
console.log('   2. –ù–∞–∂–º–∏—Ç–µ "–ò–º–ø–æ—Ä—Ç –∏–∑ Excel"')
console.log('   3. –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª —Å 406,994 –∑–∞–ø–∏—Å—è–º–∏')
console.log('   4. –ù–∞–∂–º–∏—Ç–µ "–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å"')
console.log('')
console.log('‚úÖ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:')
console.log('   - –§–∞–∑–∞ 1–∞: "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –∏–º–ø–æ—Ä—Ç—É: —É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö —Ü–µ–Ω..."')
console.log('   - –§–∞–∑–∞ 1–±: "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –∏–º–ø–æ—Ä—Ç—É: —É–¥–∞–ª–µ–Ω–æ 50,000 —Ü–µ–Ω (–∏—Ç–µ—Ä–∞—Ü–∏—è 1)..."')
console.log('   - –§–∞–∑–∞ 1–≤: "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –∏–º–ø–æ—Ä—Ç—É: —É–¥–∞–ª–µ–Ω–æ 100,000 —Ü–µ–Ω (–∏—Ç–µ—Ä–∞—Ü–∏—è 2)..."')
console.log('   - ... —Ü–∏–∫–ª –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è, –ø–æ–∫–∞ –≤—Å–µ –Ω–µ —É–¥–∞–ª–∏—Ç—Å—è ...')
console.log('   - –§–∞–∑–∞ 2: "–°—Ç–∞—Ä—ã–µ —Ü–µ–Ω—ã —É–¥–∞–ª–µ–Ω—ã (X –∑–∞–ø–∏—Å–µ–π), –Ω–∞—á–∏–Ω–∞–µ–º –∏–º–ø–æ—Ä—Ç..."')
console.log('   - –§–∞–∑–∞ 3: –ò–º–ø–æ—Ä—Ç –±–∞—Ç—á–∞–º–∏ –ø–æ 100 —Å—Ç—Ä–æ–∫ (~3-5 –º–∏–Ω—É—Ç)')
console.log('   - ‚úÖ –ò–º–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –ë–ï–ó timeout –æ—à–∏–±–æ–∫')
console.log('   - ‚úÖ "–û–±–Ω–æ–≤–ª–µ–Ω–æ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–π –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤" > 0')
console.log('   - ‚úÖ "–î–æ–±–∞–≤–ª–µ–Ω–æ —Ü–µ–Ω" > 0')
console.log('   - ‚úÖ –û–±—â–µ–µ –≤—Ä–µ–º—è: –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –æ–±—ä—ë–º–∞ –¥–∞–Ω–Ω—ã—Ö (~5-20 –º–∏–Ω—É—Ç)')
console.log('   - ‚úÖ –î–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤: UUID —Å–æ—Ö—Ä–∞–Ω—ë–Ω, –í–°–ï –¥–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã\n')
