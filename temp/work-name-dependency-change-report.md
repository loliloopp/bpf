# Отчет об изменении зависимости столбца "Наименование работ"

## Дата изменения
02.10.2025

## Статус реализации
✅ **ИЗМЕНЕНИЯ ВНЕСЕНЫ** - Зависимость столбца "Наименование работ" изменена с "Вид затрат" на "Рабочий набор"

## Что изменено

### 1. API метод
- ✅ Добавлен новый метод `getWorksByWorkSet(workSetRateId)` в `src/entities/rates/api/rates-api.ts`
- ✅ Получает работы по конкретному рабочему набору (rate_id)
- ✅ Возвращает единственную работу из выбранного рабочего набора

### 2. Компонент WorkNameSelect
- ✅ Изменен интерфейс `WorkNameSelectProps`:
  - ❌ Удалены `costTypeId` и `costCategoryId`
  - ✅ Добавлен `workSetId`
- ✅ Обновлен queryKey на `['works-by-work-set']`
- ✅ Использует новый API метод `getWorksByWorkSet(workSetId)`
- ✅ Активируется только при наличии выбранного рабочего набора

### 3. Использование в таблице
- ✅ В столбце "Наименование работ" WorkNameSelect теперь получает `workSetId`
- ✅ Удален передача `costTypeId` и `costCategoryId`
- ✅ Упрощен обработчик onChange (работа одна для рабочего набора)

### 4. Каскадная логика
- ✅ При изменении "Рабочего набора" автоматически очищаются:
  - "Наименование работ" (workName)
  - ID расценки (rateId)
- ✅ Использует workSetId вместо workSet для правильной передачи UUID

## Новая логика работы

### Старая схема (до изменения):
```
Вид затрат → Наименование работ
```

### Новая схема (после изменения):
```
Вид затрат → Рабочий набор → Наименование работ
```

## Техническая реализация

### API вызов:
```typescript
// Старый метод (больше не используется для WorkNameSelect)
ratesApi.getWorksByCategory(costTypeId, costCategoryId)

// Новый метод
ratesApi.getWorksByWorkSet(workSetRateId)
```

### Каскадная очистка:
```typescript
onChange={(newWorkSetId) => {
  onRowUpdate(record.id, {
    workSetId: newWorkSetId, // Сохраняем workSetId
    workName: '', // Очищаем наименование работ
    rateId: '' // Очищаем rateId
  })
}}
```

## Состояние сервера
- ✅ Сервер работает на http://localhost:5175
- ✅ Код компилируется без ошибок
- ✅ HMR (Hot Module Replacement) функционирует

## Результат изменений

Теперь пользователь должен:
1. Выбрать "Вид затрат"
2. Выбрать "Рабочий набор" (фильтруется по виду затрат)
3. Выбрать "Наименование работ" (показывает работу из выбранного рабочего набора)

Каждый рабочий набор содержит только одну работу, что упрощает выбор и делает интерфейс более интуитивным.

## Готово к тестированию
Изменения готовы к тестированию после применения SQL-миграции из предыдущего этапа.